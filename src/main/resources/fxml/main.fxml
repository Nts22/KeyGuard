<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.passmanager.controller.MainController"
            styleClass="main-container"
            prefHeight="920" prefWidth="1100">

    <!-- Sidebar colapsable -->
    <left>
        <HBox>
            <!-- BotÃ³n para colapsar/expandir -->
            <VBox styleClass="sidebar-toggle-container">
                <Button fx:id="toggleSidebarBtn" text="â˜°" styleClass="sidebar-toggle-btn"
                        onAction="#handleToggleSidebar"/>
            </VBox>

            <!-- Sidebar principal -->
            <VBox fx:id="sidebar" styleClass="sidebar">
                <!-- Usuario actual -->
                <HBox alignment="CENTER_LEFT" spacing="12" styleClass="user-info">
                    <StackPane styleClass="user-avatar">
                        <Label fx:id="userInitialsLabel" text="U" styleClass="user-initials"/>
                    </StackPane>
                    <VBox spacing="2">
                        <Label fx:id="currentUserLabel" text="Usuario" styleClass="user-name"/>
                        <Label text="SesiÃ³n activa" styleClass="user-status"/>
                    </VBox>
                </HBox>

                <Separator style="-fx-background-color: #334155;"/>

                <Label text="ðŸ“ CategorÃ­as" styleClass="sidebar-section-title"/>

                <ScrollPane VBox.vgrow="ALWAYS" fitToWidth="true" hbarPolicy="NEVER" styleClass="sidebar-scroll">
                    <VBox styleClass="categories-group" spacing="0">
                        <Button fx:id="allCategoriesBtn" text="Todas"
                                styleClass="category-item, category-item-selected"
                                onAction="#handleAllCategories" maxWidth="Infinity"/>

                        <VBox fx:id="categoriesContainer" spacing="0">
                            <!-- Las categorÃ­as se cargan dinÃ¡micamente -->
                        </VBox>

                        <Separator style="-fx-background-color: rgba(148, 163, 184, 0.15); -fx-padding: 4 0;"/>

                        <Button text="+ Nueva CategorÃ­a" styleClass="category-item"
                                onAction="#handleNewCategory" maxWidth="Infinity"/>
                    </VBox>
                </ScrollPane>

                <Separator style="-fx-background-color: #334155; -fx-padding: 8 0;"/>

                <!-- SecciÃ³n de Seguridad agrupada -->
                <Label text="ðŸ” Seguridad" styleClass="sidebar-section-title"/>

                <VBox styleClass="security-actions-group" spacing="0">
                    <Button text="ðŸ” Verificar ContraseÃ±as" styleClass="security-action-item"
                            onAction="#handleCheckBreaches" maxWidth="Infinity"/>

                    <Button text="ðŸ’¾ Exportar ContraseÃ±as" styleClass="security-action-item"
                            onAction="#handleExport" maxWidth="Infinity"/>

                    <Button text="ðŸ“¥ Importar ContraseÃ±as" styleClass="security-action-item"
                            onAction="#handleImport" maxWidth="Infinity"/>
                </VBox>

                <Separator style="-fx-background-color: #334155; -fx-padding: 8 0;"/>

                <!-- Tema -->
                <Label text="ðŸŽ¨ Tema" styleClass="sidebar-section-title"/>
                <HBox style="-fx-padding: 0 12;">
                    <ComboBox fx:id="themeSelector" styleClass="theme-combo" maxWidth="Infinity" HBox.hgrow="ALWAYS"/>
                </HBox>

                <Separator style="-fx-background-color: #334155; -fx-padding: 8 0;"/>

                <!-- SecciÃ³n de Cuenta (zona de peligro) -->
                <Label text="âš™ï¸ Cuenta" styleClass="sidebar-section-title"/>

                <VBox styleClass="danger-zone" spacing="0">
                    <Button text="ðŸšª Cerrar SesiÃ³n" styleClass="danger-action-item"
                            onAction="#handleLogout" maxWidth="Infinity"/>

                    <Button text="âŒ Salir" styleClass="danger-action-item"
                            onAction="#handleExit" maxWidth="Infinity"/>
                </VBox>

                <VBox.margin>
                    <Insets bottom="20"/>
                </VBox.margin>
            </VBox>
        </HBox>
    </left>

    <!-- Contenido principal -->
    <center>
        <VBox spacing="20">
            <padding>
                <Insets topRightBottomLeft="20"/>
            </padding>

            <!-- Barra superior -->
            <HBox spacing="15" alignment="CENTER_LEFT">
                <VBox spacing="2">
                    <TextField fx:id="searchField" promptText="Buscar por tÃ­tulo, usuario o email..."
                               styleClass="search-field" onKeyReleased="#handleSearch"/>
                    <Label fx:id="searchResultsLabel" styleClass="search-results-label" visible="false"/>
                </VBox>

                <Region HBox.hgrow="ALWAYS"/>

                <!-- Indicador de estado de bÃ³veda -->
                <HBox spacing="8" alignment="CENTER" styleClass="vault-status-container">
                    <Label fx:id="vaultStatusLabel" text="ðŸŸ¢ Desbloqueada"
                           styleClass="vault-status-label"/>
                    <Separator orientation="VERTICAL" prefHeight="20" style="-fx-background-color: #86efac;"/>
                    <Label fx:id="autoLockTimerLabel" text="â±ï¸ 2 min"
                           styleClass="auto-lock-timer"/>
                    <Button fx:id="manualLockBtn" text="ðŸ”’"
                            styleClass="manual-lock-btn"
                            onAction="#handleManualLock"/>
                </HBox>

                <Separator orientation="VERTICAL" prefHeight="30"/>

                <Button text="+" onAction="#handleNewEntry"
                        styleClass="button-add-entry"
                        prefWidth="45" prefHeight="38">
                    <tooltip>
                        <Tooltip text="Nueva contraseÃ±a (Ctrl+N)"/>
                    </tooltip>
                </Button>
            </HBox>

            <!-- Tabla de contraseÃ±as - altura fija para 20 filas -->
            <TableView fx:id="passwordTable" prefHeight="720" minHeight="720" maxHeight="720" fixedCellSize="30">
                <columns>
                    <TableColumn fx:id="titleColumn" text="TÃ­tulo"/>
                    <TableColumn fx:id="usernameColumn" text="Usuario"/>
                    <TableColumn fx:id="emailColumn" text="Email"/>
                    <TableColumn fx:id="categoryColumn" text="CategorÃ­a"/>
                    <TableColumn fx:id="actionsColumn" text="Acciones"/>
                </columns>
                <placeholder>
                    <Label text="No hay contraseÃ±as guardadas"/>
                </placeholder>
            </TableView>

            <!-- PaginaciÃ³n -->
            <Pagination fx:id="pagination" pageCount="1"/>
        </VBox>
    </center>
</BorderPane>
