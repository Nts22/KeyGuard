<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<VBox xmlns="http://javafx.com/javafx/17"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="com.passmanager.controller.BreachCheckController"
      styleClass="dialog-container"
      prefHeight="700" prefWidth="920"
      spacing="18">

    <padding>
        <Insets topRightBottomLeft="25"/>
    </padding>

    <!-- TÃ­tulo -->
    <VBox spacing="6">
        <Text text="ðŸ›¡ï¸ Dashboard de Seguridad" styleClass="dialog-title"/>
        <Label text="AnÃ¡lisis de brechas conocidas, contraseÃ±as duplicadas y dÃ©biles"
               styleClass="dialog-subtitle" wrapText="true"/>
    </VBox>

    <!-- Resumen: 4 cajas -->
    <HBox spacing="12">
        <VBox spacing="4" alignment="CENTER" HBox.hgrow="ALWAYS" styleClass="card"
              style="-fx-padding: 10 8; -fx-background-color: #f8fafc;">
            <Label text="Total" styleClass="field-label"/>
            <Label fx:id="totalLabel" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #1e293b;"/>
        </VBox>
        <VBox spacing="4" alignment="CENTER" HBox.hgrow="ALWAYS" styleClass="card"
              style="-fx-padding: 10 8; -fx-border-color: #ef4444; -fx-border-width: 2; -fx-border-radius: 12; -fx-background-color: rgba(239,68,68,0.06); -fx-background-radius: 12;">
            <Label text="Comprometidas" styleClass="field-label"/>
            <Label fx:id="breachedLabel" text="â€”" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #ef4444;"/>
        </VBox>
        <VBox spacing="4" alignment="CENTER" HBox.hgrow="ALWAYS" styleClass="card"
              style="-fx-padding: 10 8; -fx-border-color: #f97316; -fx-border-width: 2; -fx-border-radius: 12; -fx-background-color: rgba(249,115,22,0.06); -fx-background-radius: 12;">
            <Label text="Duplicadas" styleClass="field-label"/>
            <Label fx:id="duplicatesLabel" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #f97316;"/>
        </VBox>
        <VBox spacing="4" alignment="CENTER" HBox.hgrow="ALWAYS" styleClass="card"
              style="-fx-padding: 10 8; -fx-border-color: #eab308; -fx-border-width: 2; -fx-border-radius: 12; -fx-background-color: rgba(234,179,8,0.06); -fx-background-radius: 12;">
            <Label text="DÃ©biles" styleClass="field-label"/>
            <Label fx:id="weakLabel" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #eab308;"/>
        </VBox>
    </HBox>

    <!-- Progreso (solo durante verificaciÃ³n de brechas) -->
    <VBox fx:id="progressContainer" spacing="6" visible="false">
        <ProgressBar fx:id="progressBar" prefWidth="Infinity" progress="0"/>
        <Label fx:id="progressLabel" text="Iniciando verificaciÃ³n de brechas..." styleClass="field-label"/>
    </VBox>

    <!-- PestaÃ±as -->
    <TabPane fx:id="tabPane" VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE" styleClass="security-tab-pane">

        <!-- PestaÃ±a: Brechas conocidas -->
        <Tab text="Brechas conocidas">
            <VBox VBox.vgrow="ALWAYS" spacing="8">
                <TableView fx:id="breachTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="breachStatusColumn" text="" prefWidth="50"/>
                        <TableColumn fx:id="breachTitleColumn" text="TÃ­tulo" prefWidth="175"/>
                        <TableColumn fx:id="breachUsernameColumn" text="Usuario" prefWidth="135"/>
                        <TableColumn fx:id="breachSeverityColumn" text="Severidad" prefWidth="120"/>
                        <TableColumn fx:id="breachOccurrencesColumn" text="Apariciones" prefWidth="105"/>
                        <TableColumn fx:id="breachRecommendationColumn" text="RecomendaciÃ³n" prefWidth="240"/>
                    </columns>
                    <placeholder>
                        <Label text="No hay contraseÃ±as comprometidas"/>
                    </placeholder>
                </TableView>
                <Label text="â„¹ï¸ Usa Have I Been Pwned â€” solo se envÃ­an los primeros 5 caracteres del hash SHA-1, nunca la contraseÃ±a completa."
                       wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #64748b; -fx-padding: 0 4;"/>
            </VBox>
        </Tab>

        <!-- PestaÃ±a: Duplicadas -->
        <Tab text="Duplicadas">
            <VBox VBox.vgrow="ALWAYS" spacing="8">
                <TableView fx:id="duplicatesTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="dupTitleColumn" text="TÃ­tulo" prefWidth="220"/>
                        <TableColumn fx:id="dupUsernameColumn" text="Usuario" prefWidth="160"/>
                        <TableColumn fx:id="dupEmailColumn" text="Email" prefWidth="210"/>
                        <TableColumn fx:id="dupGroupColumn" text="Grupo" prefWidth="80"/>
                    </columns>
                    <placeholder>
                        <Label text="No hay contraseÃ±as duplicadas"/>
                    </placeholder>
                </TableView>
                <Label text="â„¹ï¸ Las entradas del mismo grupo comparten la misma contraseÃ±a. Se recomienda usar una contraseÃ±a Ãºnica por sitio."
                       wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #64748b; -fx-padding: 0 4;"/>
            </VBox>
        </Tab>

        <!-- PestaÃ±a: DÃ©biles -->
        <Tab text="DÃ©biles">
            <VBox VBox.vgrow="ALWAYS" spacing="8">
                <TableView fx:id="weakTable" VBox.vgrow="ALWAYS">
                    <columns>
                        <TableColumn fx:id="weakTitleColumn" text="TÃ­tulo" prefWidth="230"/>
                        <TableColumn fx:id="weakUsernameColumn" text="Usuario" prefWidth="170"/>
                        <TableColumn fx:id="weakStrengthColumn" text="Fortaleza" prefWidth="130"/>
                        <TableColumn fx:id="weakLengthColumn" text="Largo" prefWidth="80"/>
                    </columns>
                    <placeholder>
                        <Label text="Todas tus contraseÃ±as son fuertes"/>
                    </placeholder>
                </TableView>
                <Label text="â„¹ï¸ Se muestran las clasificadas como 'Muy dÃ©bil' o 'DÃ©bil'. Considera cambiarlas por contraseÃ±as mÃ¡s largas y complejas."
                       wrapText="true" style="-fx-font-size: 11px; -fx-text-fill: #64748b; -fx-padding: 0 4;"/>
            </VBox>
        </Tab>
    </TabPane>

    <!-- Botones -->
    <HBox spacing="10" alignment="CENTER_RIGHT">
        <Button text="Cerrar" onAction="#handleClose" styleClass="btn-secondary"/>
    </HBox>

</VBox>
